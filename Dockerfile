FROM node:11 AS node
WORKDIR /app/frontend/src
COPY frontend/src/package*.json /app/frontend/src/
RUN npm install
COPY frontend/src /app/frontend/src/
RUN npm run-script build

FROM maven:3-openjdk-11 AS maven
WORKDIR /app
COPY . /app
COPY --from=node /app/frontend/src/dist /app/frontend/src/dist
RUN ls -la
RUN ls -la /app/frontend/src
RUN ls -la /app/frontend/src/dist
RUN mvn package

FROM openjdk:11-slim
WORKDIR /app
# ADD ../target/jacksonrce-fullapp-*.war jacksonrce-fullapp.war
COPY --from=maven /app/target/jacksonrce-fullapp-*.war jacksonrce-fullapp.war
RUN bash -c 'touch jacksonrce-fullapp.war'
ENTRYPOINT ["java","-Djava.security.egd=file:/dev/./urandom","-jar","jacksonrce-fullapp.war"]
